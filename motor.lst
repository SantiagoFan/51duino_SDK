C51 COMPILER V9.00   MOTOR                                                                 09/06/2015 20:47:09 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN motor.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE Source\motor.c BROWSE INCDIR(..\µç»ú¿ØÖÆ) DEBUG OBJECTEXTEND PRINT(.\motor.
                    -lst) OBJECT(motor.obj)

line level    source

   1          /*
   2          °æÈ¨ÉùÃ÷£º
   3          ÉîÛÚÊÐÐ¡¶þ¼«¿Í¿Æ¼¼£¨Ð¡R¿Æ¼¼£©ÆìÏÂ£ºWIFI»úÆ÷ÈËÍø¡¤»úÆ÷ÈË´´Òâ¹¤×÷ÊÒ°æÈ¨ËùÓÐ www.wifi-robots.com
   4          Äú¿ÉÒÔÈÎÒâÐÞ¸Ä±¾³ÌÐò£¬²¢Ó¦ÓÃÓÚ×ÔÐÐÑÐ·¢µÄÖÇÄÜÐ¡³µ»úÆ÷ÈË¼°ÆäËûµç×Ó²úÆ·ÉÏ£¬µ«ÊÇ½ûÖ¹ÓÃÓÚÉÌÒµÄ²Àû¡£
   5          Ð¡R¿Æ¼¼±£Áô¸¶Öî·¨ÂÉÆðËßÇÖÈ¨µÄÈ¨Àû£¡2015-8-22
   6          By WIFI»úÆ÷ÈËÍø¡¤»úÆ÷ÈË´´Òâ¹¤×÷ÊÒ
   7          */
   8          #include "motor.h"
   9          #include "uart.h"
  10          #include "timer.h"
  11          #include "mem.h"
  12          #include "ultrasonic.h"
  13          #include "config.h"
  14          uchar Cruising_Flag =0x00;
  15          uchar  Robots_Run_Status;
  16          uchar Pre_Cruising_Flag = 0x00;
  17          uint8 Left_Speed = 10; //×ó²àËÙ¶È
  18          uint8 Right_Speed = 10; //ÓÒ²àËÙ¶È
  19          uint8 Left_Speed_Hold=10;       //×ó²àËÙ¶ÈËø´æ
  20          uint8 Right_Speed_Hold=10; //ÓÒ²àËÙ¶ÈËø´æ
  21          /*
  22            Motor_Init(void)º¯Êý
  23            ×÷ÓÃ£º³õÊ¼»¯µç»úÇý¶¯Ð¾Æ¬£¬L298PÊ¹ÄÜ¶ËÖÃ¸ßµçÆ½
  24            ²ÎÊý£ºÎÞ
  25            ·µ»ØÖµ£ºÎÞ
  26            powered by tianyalu
  27          */
  28          void Motor_Init(void)
  29          {
  30   1              MOTOR_A_EN=1;
  31   1              MOTOR_B_EN=1;
  32   1              MOTOR_GO_STOP;
  33   1      }
  34          
  35          /*
  36            Follow_Track(void)º¯Êý
  37            ×÷ÓÃ£ºÈ«¹¦ÄÜ¸úËæÖ÷ÈËÄ£Ê½£¬¸úËæÇ°·½ÒÆ¶¯ÎïÌå
  38            ²ÎÊý£ºÎÞ
  39            ·µ»ØÖµ£ºÎÞ
  40            powered by liuviking
  41          */
  42          void Follow_Track(void)
  43          {
  44   1                      switch(Robots_Run_Status)
  45   1                       {
  46   2                              case 0x01:MOTOR_GO_RIGHT;     break;    
  47   2                              case 0x02:MOTOR_GO_LEFT;     break;        
  48   2                              case 0x03:MOTOR_GO_FORWARD;  break;        
  49   2                              case 0x04:MOTOR_GO_STOP;  break;        
  50   2                       }
  51   1      
  52   1                      
  53   1                   if(Input_Detect1 == 1)     //ÖÐ¼ä´«¸ÐÆ÷OK
  54   1                        {
C51 COMPILER V9.00   MOTOR                                                                 09/06/2015 20:47:09 PAGE 2   

  55   2                        
  56   2                              if((Input_Detect0 == 0)&& (Input_Detect2 == 0)) //Á½±ßÍ¬Ê±Ì½²âµ½ÕÏ°­Îï
  57   2                              {
  58   3                              
  59   3                                       Robots_Run_Status=0x04;//Í£Ö¹ 
  60   3                              } 
  61   2                               
  62   2                              if((Input_Detect0 == 0)&& (Input_Detect2 == 1))//×ó²àÕÏ°­Îï
  63   2                              {
  64   3                              
  65   3                                      Robots_Run_Status=0x01;//ÓÒ×ª 
  66   3                              }
  67   2                      
  68   2                              if((Input_Detect0 == 1)&& (Input_Detect2 == 0))//ÓÒ²àÕÏ°­Îï
  69   2                              {
  70   3                                      Robots_Run_Status=0x02;//×ó×ª 
  71   3                              }
  72   2                               
  73   2                              if((Input_Detect0 == 1)&& (Input_Detect2 == 1))//ÎÞÈÎºÎÕÏ°­Îï
  74   2                              {
  75   3                                      Robots_Run_Status=0x03;//Ö±ÐÐ 
  76   3                              }
  77   2                        }
  78   1                        else
  79   1                        {
  80   2                                 Robots_Run_Status=0x04;
  81   2                        }
  82   1      
  83   1      }
  84          /*
  85            FollowLine(void)º¯Êý
  86            ×÷ÓÃ£ºÈ«¹¦ÄÜÑ²Ïß¶Ý¼£Ä£Ê½£¬ºìÍâÑ°ºÚÏß
  87            ²ÎÊý£ºÎÞ
  88            ·µ»ØÖµ£ºÎÞ
  89            powered by liuviking
  90          */
  91          void FollowLine(void)
  92          {
  93   1                      switch(Robots_Run_Status)
  94   1                       {
  95   2                              case 0x01:MOTOR_GO_RIGHT;     break;    
  96   2                              case 0x02:MOTOR_GO_LEFT;     break;        
  97   2                              case 0x03:MOTOR_GO_FORWARD;  break;        
  98   2                              case 0x04:MOTOR_GO_STOP;  break;        
  99   2                       }
 100   1      
 101   1                              if((Input_Detect_LEFT == 0)&& (Input_Detect_RIGHT == 0))//Á½±ßÍ¬Ê±Ì½²âµ½ÕÏ°­Îï
 102   1                              {
 103   2                              
 104   2                                       Robots_Run_Status=0x03;//Ö±ÐÐ 
 105   2                              } 
 106   1                               
 107   1                              if((Input_Detect_LEFT == 0)&& (Input_Detect_RIGHT == 1))//ÓÒ²àÓöµ½ÕÏ°­  
 108   1                              {
 109   2                              
 110   2                                      Robots_Run_Status=0x02;//×ó×ª 
 111   2                              }
 112   1                      
 113   1                              if((Input_Detect_LEFT == 1)&& (Input_Detect_RIGHT == 0))//×ó²àÓöµ½ÕÏ°­ 
 114   1                              {
 115   2                                      Robots_Run_Status=0x01;//ÓÒ×ª 
 116   2                              }
C51 COMPILER V9.00   MOTOR                                                                 09/06/2015 20:47:09 PAGE 3   

 117   1                               
 118   1                              if((Input_Detect_LEFT == 1)&& (Input_Detect_RIGHT == 1))//×óÓÒ¶¼¼ì²âµ½£¬¾ÍÈçÊÓÆµÖÐµÄÄÇÑùÓöµ½Ò»µÀºáµÄ½º´
             -ø 
 119   1                              {
 120   2                                      Robots_Run_Status=0x04;//Í£Ö¹ 
 121   2                              }
 122   1      }
 123          /*
 124            Avoiding(void)º¯Êý
 125            ×÷ÓÃ£ºÈ«¹¦ÄÜºìÍâ±ÜÕÏÄ£Ê½£¬ºìÍâÌ½²âÇ°·½ÕÏ°­Í£³µ£¬·ÀµôÂäÐüÑÂÍ£³µ
 126            ²ÎÊý£ºÎÞ
 127            ·µ»ØÖµ£ºÎÞ
 128            powered by liuviking
 129          */
 130          void Avoiding(void)
 131          {
 132   1                       switch(Robots_Run_Status)
 133   1                       {
 134   2                              case 0x01:MOTOR_GO_RIGHT;     break;    
 135   2                              case 0x02:MOTOR_GO_LEFT;     break;        
 136   2                              case 0x03:MOTOR_GO_FORWARD;  break;        
 137   2                              case 0x04:MOTOR_GO_STOP;  break;
 138   2                              case 0x05:MOTOR_GO_BACK; break;            
 139   2                       }
 140   1      
 141   1                              if((Input_Detect_LEFT == 1) || (Input_Detect_RIGHT == 1) || (Input_Detect1==0))
 142   1                              {
 143   2                          
 144   2                                      Robots_Run_Status=0x04;
 145   2                              } 
 146   1                              else //·ñÔòµç»úÖ´ÐÐÇ°½ø¶¯×÷
 147   1                              {
 148   2                                        Robots_Run_Status=0x03;
 149   2                              }
 150   1      }
 151                   
 152          
 153          /*
 154            Cruising_Mod(void)º¯Êý
 155            ×÷ÓÃ£ºÈ«¹¦ÄÜÄ£Ê½Ñ¡Ôñº¯Êý
 156            ²ÎÊý£ºÎÞ
 157            ·µ»ØÖµ£ºÎÞ
 158            powered by tianyalu
 159          */
 160          void Cruising_Mod(void)
 161          {
 162   1             
 163   1               if(Pre_Cruising_Flag != Cruising_Flag)
 164   1               {
 165   2                   if(Pre_Cruising_Flag != 0)
 166   2                       {
 167   3                           MOTOR_GO_STOP; 
 168   3                       }
 169   2      
 170   2               Pre_Cruising_Flag =  Cruising_Flag;
 171   2               }      
 172   1      
 173   1              switch(Cruising_Flag)
 174   1              {
 175   2                 //case 0x00:Send_Distance();//³¬Éù²¨²â¾à£¬Ê¹ÓÃ´Ë¹¦ÄÜÇ°£¬ÇëÈ·±£WiFiÄ£¿éË«ÏòÊý¾Ý¹¦ÄÜÒÑ¾­´ò¿ª£¬·ñÔò»áÔì³É
             -¿Í»§¶ËÓëÄ£¿éµÄÁ¬½ÓÖÐ¶Ï¡£
 176   2                 //¿ª·ÅË«ÏòÊý¾Ý½Ì³Ì£º http://www.wifi-robots.com/thread-2985-1-1.html
C51 COMPILER V9.00   MOTOR                                                                 09/06/2015 20:47:09 PAGE 4   

 177   2                 case 0x01:Follow_Track(); break;//¸úËæÄ£Ê½
 178   2                 case 0x02:FollowLine(); break;//Ñ²ÏßÄ£Ê½
 179   2                 case 0x03:Avoiding(); break;//±ÜÕÏÄ£Ê½
 180   2                 case 0x04:AvoidByRadar();break;//³¬Éù²¨±ÚÕÏÄ£Ê½
 181   2                 case 0x05:ARMShow();break;
*** WARNING C206 IN LINE 181 OF SOURCE\MOTOR.C: 'ARMShow': missing function-prototype
 182   2                 case 0x06:HeadShow();break;
*** WARNING C206 IN LINE 182 OF SOURCE\MOTOR.C: 'HeadShow': missing function-prototype
 183   2                 default:break;
 184   2              }        
 185   1      }
 186          
 187          
 188          void Delay_ForBarrier(uint32 t)
 189          {  
 190   1          uint16 i;
 191   1              while(t--)
 192   1              {
 193   2                 for(i=0;i<1050;i++);
 194   2              }
 195   1      }
 196          
 197          
 198          
 199          
 200          
 201          
 202          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    487    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
